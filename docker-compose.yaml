#-------------------------------------------------------------
# Docker compose
#-------------------------------------------------------------
version: '3.8'

services:  
  #--------------------------------------------------------------------------------------------#
  #                               Homarr -  A homepage for your server.                        #
  #   Simple and lightweight homepage for your server.
  #   That helps you easily access all of your services in one place.
  #   https://github.com/ajnart/homarr
  #--------------------------------------------------------------------------------------------#
  homarr:
    container_name: homarr
    image: ghcr.io/ajnart/homarr:latest
    restart: unless-stopped
    volumes:
      - ${SELF_HOME_DIR}/homarr:/app/data/configs
    ports:
      - '7575:7575'

  #--------------------------------------------------------------------------------------------#
  #                              n8n                                                           #
  #   The workflow automation platform that doesn't box you in, that you never outgrow         #
  #   https://n8n.io/
  #--------------------------------------------------------------------------------------------#
  n8n:
    image: n8nio/n8n
    container_name: n8n
    restart: always
    ports:
      - 5678:5678
    depends_on:
      - db
    env_file:
      - .env
    volumes:
      - ${SELF_HOME_DIR}/.n8n:/home/node/.n8n
    # Wait 5 seconds to start n8n to make sure that DB is ready
    # when n8n tries to connect to it
    command: /bin/sh -c "sleep 5; n8n start"

  # Ghostfolio
  # Open Source Wealth Management Software 
  # The application empowers busy people to keep track of stocks, 
  # ETFs or cryptocurrencies and make solid, data-driven investment decisions.
  # https://github.com/ghostfolio/ghostfolio
  ghostfolio:
    container_name: ghostfolio
    image: ghostfolio/ghostfolio
    restart: unless-stopped
    env_file:
      - .env
    environment:
      DATABASE_URL: postgresql://user:password@postgres:5432/ghostfolio-db?sslmode=prefer
      REDIS_HOST: 'redis'
    depends_on:
      - postgres
      - redis
    ports:
      - 3333:3333
